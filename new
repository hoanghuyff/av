task.wait(20)
local TeleportService = game:GetService("TeleportService")
local Players = game:GetService("Players")
local HttpService = game:GetService("HttpService")
local LocalPlayer = Players.LocalPlayer

-- ğŸ“‚ Cáº¥u hÃ¬nh file lÆ°u dá»¯ liá»‡u
local folderPath = "faker/"
local filePath = folderPath .. LocalPlayer.Name .. ".json"

-- ğŸŒŸ Danh sÃ¡ch game
local bloxFruitsUniverseID = 2753915549
local bloxFruitsPlaceIDs = {2753915549, 4442272183, 7449423635} -- Sea 1, 2, 3

local popularGameIDs = {
    6516141723, 286090429, 155615604, 2788229376, 3260590327,
    142823291, 13772394663, 6284583030, 9498006165
}

-- ğŸ”„ Biáº¿n tráº¡ng thÃ¡i
local step = 0
local lastAFKTime = 0
local totalJumps = 0

-- â³ **Thá»i gian chá»**
local minBloxTime, maxBloxTime = 7200, 18000  -- 2-5 giá» trong Blox Fruits
local minGameTime, maxGameTime = 300, 600     -- 5-10 phÃºt trong game khÃ¡c

-- ğŸ“Œ Kiá»ƒm tra xem cÃ³ á»Ÿ Blox Fruits khÃ´ng
local function isInBloxFruits()
    return game.GameId == bloxFruitsUniverseID
end

-- ğŸ¯ Láº¥y game hot ngáº«u nhiÃªn
local function getHotGame()
    return popularGameIDs[math.random(1, #popularGameIDs)]
end

-- ğŸ” Láº¥y Sea 1 cá»§a Blox Fruits Ä‘á»ƒ quay vá»
local function getBloxFruitsSea1()
    return 2753915549
end

-- ğŸ“‚ Táº¡o thÆ° má»¥c náº¿u chÆ°a cÃ³
if not isfolder(folderPath) then makefolder(folderPath) end

-- ğŸ“‚ Äá»c dá»¯ liá»‡u tá»« file náº¿u Ä‘Ã£ tá»“n táº¡i
if pcall(function() return readfile(filePath) end) then
    local content = readfile(filePath)
    local success, data = pcall(function() return HttpService:JSONDecode(content) end)
    if success and type(data) == "table" then
        step = data.step or 0
        lastAFKTime = data.lastAFKTime or 0
        totalJumps = data.totalJumps or 0
    else
        lastAFKTime = os.time()
    end
else
    lastAFKTime = os.time()
end

-- ğŸ“‚ HÃ m lÆ°u dá»¯ liá»‡u vÃ o file má»—i 5 giÃ¢y
local function saveData()
    local timeNow = os.time()
    local data = {
        lastAFKTime = lastAFKTime,
        totalTimeAFK = timeNow - lastAFKTime, -- TÃ­nh thá»i gian Ä‘Ã£ trÃ´i qua
        totalJumps = totalJumps,
        step = step
    }
    writefile(filePath, HttpService:JSONEncode(data))
end

-- ğŸš€ HÃ m teleport (Cáº¬P NHáº¬T `lastAFKTime` trÆ°á»›c khi teleport)
local function safeTeleport(targetGameID)
    if not targetGameID then return end
    lastAFKTime = os.time() -- âœ… Cáº­p nháº­t ngay khi teleport
    totalJumps = totalJumps + 1 -- TÄƒng sá»‘ láº§n nháº£y game
    saveData()

    local success, errorMessage = pcall(function()
        TeleportService:Teleport(targetGameID, LocalPlayer)
    end)

    if not success then
        print("âš  [ERROR] Teleport lá»—i: " .. errorMessage)
        if string.find(errorMessage, "restricted") then
            game:Shutdown()
        else
            task.wait(10)
            safeTeleport(getHotGame())
        end
    end
end

-- â³ Kiá»ƒm tra AFK vÃ  nháº£y game
local function checkAFK()
    while true do
        task.wait(1)  -- ğŸ”„ Cáº­p nháº­t má»—i giÃ¢y
        local totalAFKTime = os.time() - lastAFKTime

        if step == 0 and isInBloxFruits() then
            if totalAFKTime >= math.random(minBloxTime, maxBloxTime) then
                lastAFKTime = os.time()
                step = 1
                saveData()
                safeTeleport(getHotGame())
            end
        elseif step == 1 then
            if totalAFKTime >= math.random(minGameTime, maxGameTime) then
                lastAFKTime = os.time()
                step = 2
                saveData()
                safeTeleport(getHotGame())
            end
        elseif step == 2 then
            if totalAFKTime >= math.random(minGameTime, maxGameTime) then
                lastAFKTime = os.time()
                step = 0
                saveData()
                safeTeleport(getBloxFruitsSea1())
            end
        end
    end
end

-- ğŸ” Auto lÆ°u file má»—i 5 giÃ¢y
local function autoSaveLoop()
    while true do
        task.wait(5)
        saveData()
    end
end

-- ğŸ” Theo dÃµi teleport thÃ nh cÃ´ng/tháº¥t báº¡i
LocalPlayer.OnTeleport:Connect(function(state)
    if state == Enum.TeleportState.Started then
        lastAFKTime = os.time()
        saveData()
    elseif state == Enum.TeleportState.Failed then
        safeTeleport(getHotGame()) 
    end
end)

-- ğŸš€ Cháº¡y kiá»ƒm tra AFK
task.spawn(checkAFK)

-- ğŸš€ Cháº¡y auto save file má»—i 5 giÃ¢y
task.spawn(autoSaveLoop)

-- ğŸ“‚ **Ghi file ngay khi execute**
saveData()
