-- Khá»Ÿi táº¡o an toÃ n vá»›i CoreGui
local success, result = pcall(function()
    -- Core Services
    local Players = game:GetService('Players')
    local RunService = game:GetService('RunService')
    
    -- Biáº¿n local Ä‘á»ƒ trÃ¡nh xung Ä‘á»™t
    local Client = Players.LocalPlayer
    local SentList = {}
    local IsRunning = false
    
    -- Config an toÃ n
    local Config = {
        SendDelay = 2,        -- TÄƒng delay Ä‘á»ƒ trÃ¡nh xung Ä‘á»™t
        CheckInterval = 300,
        MaxRequests = 10      -- Giá»›i háº¡n sá»‘ lÆ°á»£ng request má»—i phiÃªn
    }
    
    -- Kiá»ƒm tra an toÃ n
    local function SafeCheck()
        if not Client or not Client.Character then
            return false
        end
        return true
    end
    
    -- Äáº¿m sá»‘ request Ä‘Ã£ gá»­i
    local RequestCount = 0
    
    -- HÃ m gá»­i yÃªu cáº§u an toÃ n
    local function SafeSendRequest(player)
        if not SafeCheck() then return false end
        if RequestCount >= Config.MaxRequests then return false end
        
        -- Kiá»ƒm tra player há»£p lá»‡
        if not player or not player.Parent or not player:IsA("Player") then
            return false
        end
        
        -- Kiá»ƒm tra Ä‘iá»u kiá»‡n
        if player == Client or SentList[player.UserId] then
            return false
        end
        
        -- Thá»­ gá»­i yÃªu cáº§u
        local success = pcall(function()
            Client:RequestFriendship(player)
        end)
        
        if success then
            SentList[player.UserId] = true
            RequestCount = RequestCount + 1
            print("âœ… ÄÃ£ gá»­i yÃªu cáº§u káº¿t báº¡n tá»›i:", player.Name)
        end
        
        return success
    end
    
    -- HÃ m cháº¥p nháº­n yÃªu cáº§u an toÃ n
    local function SafeAcceptRequest(request)
        if not SafeCheck() then return false end
        
        local success = pcall(function()
            Client:RequestFriendship(request)
        end)
        
        if success then
            print("âœ… ÄÃ£ cháº¥p nháº­n káº¿t báº¡n tá»«:", request.Name)
        end
        
        return success
    end
    
    -- HÃ m chÃ­nh Ä‘á»ƒ auto friend
    local function AutoFriend()
        if IsRunning then return end
        IsRunning = true
        
        -- Reset counter má»—i phiÃªn
        RequestCount = 0
        
        -- Main loop
        task.spawn(function()
            while IsRunning do
                if SafeCheck() then
                    -- Gá»­i yÃªu cáº§u
                    if RequestCount < Config.MaxRequests then
                        for _, player in ipairs(Players:GetPlayers()) do
                            if IsRunning then
                                SafeSendRequest(player)
                                task.wait(Config.SendDelay)
                            end
                        end
                    end
                    
                    -- Cháº¥p nháº­n yÃªu cáº§u
                    pcall(function()
                        local requests = Client:GetFriendRequests()
                        for _, request in ipairs(requests) do
                            if IsRunning then
                                SafeAcceptRequest(request)
                                task.wait(1)
                            end
                        end
                    end)
                end
                
                task.wait(Config.CheckInterval)
            end
        end)
    end
    
    -- Xá»­ lÃ½ player má»›i
    Players.PlayerAdded:Connect(function(player)
        if IsRunning and RequestCount < Config.MaxRequests then
            task.wait(3) -- Äá»£i Ä‘á»ƒ trÃ¡nh xung Ä‘á»™t
            SafeSendRequest(player)
        end
    end)
    
    -- API an toÃ n
    local SafeAutoFriend = {
        Start = function()
            if not SafeCheck() then
                warn("âš ï¸ KhÃ´ng thá»ƒ khá»Ÿi Ä‘á»™ng Auto Friend - Kiá»ƒm tra láº¡i nhÃ¢n váº­t!")
                return
            end
            
            print("ğŸš€ Äang khá»Ÿi Ä‘á»™ng Auto Friend...")
            AutoFriend()
            print("âœ¨ Auto Friend Ä‘Ã£ khá»Ÿi Ä‘á»™ng!")
        end,
        
        Stop = function()
            IsRunning = false
            print("ğŸ›‘ Auto Friend Ä‘Ã£ dá»«ng!")
        end,
        
        GetStatus = function()
            return {
                Running = IsRunning,
                RequestsSent = RequestCount,
                MaxRequests = Config.MaxRequests
            }
        end
    }
    
    return SafeAutoFriend
end)

-- Khá»Ÿi Ä‘á»™ng an toÃ n
if success and result then
    _G.SafeAutoFriend = result
    
    -- Äá»£i character load
    task.wait(5)
    
    -- Thá»­ khá»Ÿi Ä‘á»™ng
    pcall(function()
        _G.SafeAutoFriend.Start()
    end)
else
    warn("âŒ KhÃ´ng thá»ƒ khá»Ÿi táº¡o Auto Friend:", result)
end
