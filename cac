-- Táº¡o má»™t namespace Ä‘á»™c láº­p hoÃ n toÃ n
local SafeAutoFriend = {}

-- Wrap toÃ n bá»™ chá»©c nÄƒng trong má»™t function riÃªng
function SafeAutoFriend.Initialize()
    -- Táº¡o services vá»›i tÃªn khÃ¡c Ä‘á»ƒ trÃ¡nh xung Ä‘á»™t
    local PlayerService = game:GetService('Players')
    local MyPlayer = PlayerService.LocalPlayer
    
    -- Táº¡o cÃ¡c biáº¿n cáº¥u hÃ¬nh trong namespace riÃªng
    SafeAutoFriend.Config = {
        SendEnabled = true,
        AcceptEnabled = true,
        SendDelay = 1,
        CheckInterval = 300,
        MaxFriends = 200
    }
    
    -- LÆ°u trá»¯ riÃªng
    local SentList = {}
    
    -- Functions vá»›i tÃªn Ä‘á»™c nháº¥t
    local function SafeCheckFriend(player)
        local success, isFriend = pcall(function()
            return MyPlayer:IsFriendsWith(player.UserId)
        end)
        return success and isFriend or false
    end
    
    local function SafeGetFriendCount()
        local success, count = pcall(function()
            return #MyPlayer:GetFriendsOnline()
        end)
        return success and count or 0
    end
    
    -- HÃ m gá»­i yÃªu cáº§u an toÃ n
    local function SafeSendRequest(player)
        if not player or typeof(player) ~= "Instance" or not player:IsA("Player") then
            return false
        end
        
        -- Kiá»ƒm tra cÃ¡c Ä‘iá»u kiá»‡n
        if SentList[player.Name] or SafeCheckFriend(player) then
            return false
        end
        
        local success = pcall(function()
            task.wait(0.5) -- Äá»£i ngáº¯n Ä‘á»ƒ trÃ¡nh xung Ä‘á»™t
            MyPlayer:RequestFriendship(player)
        end)
        
        if success then
            SentList[player.Name] = true
            print("âœ… [Safe] ÄÃ£ gá»­i yÃªu cáº§u káº¿t báº¡n tá»›i:", player.Name)
        end
        
        return success
    end
    
    -- Auto Accept riÃªng biá»‡t
    local function SafeAutoAccept()
        while SafeAutoFriend.Config.AcceptEnabled do
            pcall(function()
                if SafeGetFriendCount() < SafeAutoFriend.Config.MaxFriends then
                    local requests = MyPlayer:GetFriendRequests()
                    for _, request in ipairs(requests) do
                        task.wait(1.5) -- Äá»£i lÃ¢u hÆ¡n Ä‘á»ƒ trÃ¡nh xung Ä‘á»™t
                        pcall(function()
                            MyPlayer:RequestFriendship(request)
                        end)
                        print("âœ… [Safe] ÄÃ£ cháº¥p nháº­n káº¿t báº¡n tá»«:", request.Name)
                    end
                end
            end)
            task.wait(10)
        end
    end
    
    -- Auto Send riÃªng biá»‡t
    local function SafeAutoSend()
        while SafeAutoFriend.Config.SendEnabled do
            pcall(function()
                if SafeGetFriendCount() < SafeAutoFriend.Config.MaxFriends then
                    for _, player in ipairs(PlayerService:GetPlayers()) do
                        if player ~= MyPlayer then
                            SafeSendRequest(player)
                            task.wait(SafeAutoFriend.Config.SendDelay)
                        end
                    end
                end
            end)
            task.wait(SafeAutoFriend.Config.CheckInterval)
        end
    end
    
    -- PlayerAdded vá»›i delay an toÃ n
    PlayerService.PlayerAdded:Connect(function(player)
        task.wait(2) -- Äá»£i Ä‘á»ƒ trÃ¡nh xung Ä‘á»™t vá»›i script khÃ¡c
        if SafeAutoFriend.Config.SendEnabled then
            SafeSendRequest(player)
        end
    end)
    
    -- HÃ m Start/Stop an toÃ n
    function SafeAutoFriend:Start()
        if self.Running then return end
        self.Running = true
        
        -- Khá»Ÿi Ä‘á»™ng vá»›i delay
        task.wait(5) -- Äá»£i cÃ¡c script khÃ¡c cháº¡y xong
        print("ğŸš€ [Safe] Auto Friend Ä‘ang khá»Ÿi Ä‘á»™ng...")
        
        -- Spawn riÃªng biá»‡t
        task.spawn(SafeAutoSend)
        task.wait(2)
        task.spawn(SafeAutoAccept)
        
        print("âœ¨ [Safe] Auto Friend Ä‘Ã£ khá»Ÿi Ä‘á»™ng!")
    end
    
    function SafeAutoFriend:Stop()
        self.Running = false
        self.Config.SendEnabled = false
        self.Config.AcceptEnabled = false
        print("ğŸ›‘ [Safe] Auto Friend Ä‘Ã£ dá»«ng!")
    end
    
    return SafeAutoFriend
end

-- Khá»Ÿi táº¡o trong mÃ´i trÆ°á»ng riÃªng
local success, AutoFriendInstance = pcall(SafeAutoFriend.Initialize)

if success and AutoFriendInstance then
    -- LÆ°u instance vÃ o biáº¿n global vá»›i tÃªn Ä‘á»™c nháº¥t
    _G.SafeAutoFriendV2 = AutoFriendInstance
    
    -- Khá»Ÿi Ä‘á»™ng vá»›i delay
    task.wait(10) -- Äá»£i thÃªm thá»i gian Ä‘á»ƒ script khÃ¡c cháº¡y xong
    AutoFriendInstance:Start()
else
    warn("âŒ KhÃ´ng thá»ƒ khá»Ÿi táº¡o Safe Auto Friend!")
end
