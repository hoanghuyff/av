-- Kiá»ƒm tra xem script Ä‘Ã£ Ä‘Æ°á»£c cháº¡y chÆ°a
if _G.AutoFriendInitialized then
    warn("âš ï¸ Auto Friend script Ä‘Ã£ Ä‘Æ°á»£c khá»Ÿi cháº¡y!")
    return
end

local Players = game:GetService('Players')
local Client = Players.LocalPlayer

-- ÄÃ¡nh dáº¥u script Ä‘Ã£ Ä‘Æ°á»£c khá»Ÿi táº¡o
_G.AutoFriendInitialized = true

-- Cáº¥u hÃ¬nh (sá»­ dá»¥ng báº£ng cáº¥u hÃ¬nh riÃªng Ä‘á»ƒ trÃ¡nh xung Ä‘á»™t)
local Config = {
    EnableFriendRequest = true,
    EnableAutoAccept = true,
    WaitToSendFriend = 300,
    RequestDelay = 1,
    MaxFriends = 200
}

-- Táº¡o namespace riÃªng Ä‘á»ƒ trÃ¡nh xung Ä‘á»™t biáº¿n toÃ n cá»¥c
local AutoFriend = {
    AlreadySent = {},
    Running = false
}

-- CÃ¡c hÃ m tiá»‡n Ã­ch
function AutoFriend:IsAlreadyFriend(player)
    local success, result = pcall(function()
        return Client:IsFriendsWith(player.UserId)
    end)
    return success and result or false
end

function AutoFriend:GetFriendCount()
    local success, count = pcall(function()
        return #Client:GetFriendsOnline()
    end)
    return success and count or 0
end

-- HÃ m gá»­i yÃªu cáº§u káº¿t báº¡n
function AutoFriend:SendRequest(player)
    if not player or not player.UserId then return false end
    
    local success = pcall(function()
        Client:RequestFriendship(player)
    end)
    
    if success then
        self.AlreadySent[player.Name] = true
        print("âœ… Gá»­i yÃªu cáº§u káº¿t báº¡n tá»›i:", player.Name)
    end
    
    return success
end

-- HÃ m tá»± Ä‘á»™ng cháº¥p nháº­n
function AutoFriend:StartAutoAccept()
    if self.AcceptRunning then return end
    self.AcceptRunning = true
    
    task.spawn(function()
        while Config.EnableAutoAccept and self.AcceptRunning do
            pcall(function()
                local requests = Client:GetFriendRequests()
                for _, request in ipairs(requests) do
                    if self:GetFriendCount() < Config.MaxFriends then
                        pcall(function()
                            Client:RequestFriendship(request)
                        end)
                        print("âœ… Cháº¥p nháº­n káº¿t báº¡n tá»«:", request.Name)
                        task.wait(1)
                    end
                end
            end)
            task.wait(5)
        end
    end)
end

-- HÃ m tá»± Ä‘á»™ng gá»­i yÃªu cáº§u
function AutoFriend:StartAutoSend()
    if self.SendRunning then return end
    self.SendRunning = true
    
    task.spawn(function()
        while Config.EnableFriendRequest and self.SendRunning do
            if self:GetFriendCount() < Config.MaxFriends then
                for _, player in ipairs(Players:GetPlayers()) do
                    if player ~= Client 
                        and not self.AlreadySent[player.Name] 
                        and not self:IsAlreadyFriend(player) 
                    then
                        self:SendRequest(player)
                        task.wait(Config.RequestDelay)
                    end
                end
            end
            task.wait(Config.WaitToSendFriend)
        end
    end)
end

-- Xá»­ lÃ½ ngÆ°á»i chÆ¡i má»›i
Players.PlayerAdded:Connect(function(player)
    if Config.EnableFriendRequest 
        and not AutoFriend.AlreadySent[player.Name] 
        and not AutoFriend:IsAlreadyFriend(player)
        and AutoFriend:GetFriendCount() < Config.MaxFriends 
    then
        task.wait(Config.RequestDelay)
        AutoFriend:SendRequest(player)
    end
end)

-- HÃ m dá»«ng script
function AutoFriend:Stop()
    self.SendRunning = false
    self.AcceptRunning = false
    print("ğŸ›‘ Auto Friend Ä‘Ã£ dá»«ng!")
end

-- HÃ m khá»Ÿi Ä‘á»™ng script
function AutoFriend:Start()
    if self.Running then return end
    self.Running = true
    
    print("ğŸš€ Auto Friend Ä‘ang khá»Ÿi Ä‘á»™ng...")
    self:StartAutoSend()
    self:StartAutoAccept()
    
    print("âœ¨ Auto Friend Ä‘Ã£ khá»Ÿi Ä‘á»™ng thÃ nh cÃ´ng!")
    print("â¡ï¸ Auto Send:", Config.EnableFriendRequest and "Báº­t" or "Táº¯t")
    print("â¡ï¸ Auto Accept:", Config.EnableAutoAccept and "Báº­t" or "Táº¯t")
end

-- Táº¡o backup Ä‘á»ƒ cÃ³ thá»ƒ truy cáº­p sau nÃ y
_G.AutoFriend = AutoFriend

-- Khá»Ÿi Ä‘á»™ng script
AutoFriend:Start()
